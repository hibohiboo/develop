version: '3'
services:
  # プロキシサーバー
  # http://192.168.50.10/ -> http://server/
  # http://192.168.50.10/tests -> http://jasmine/tests/
  proxy:
    build: ./tools/proxy
    volumes:
      - ./tools/proxy/conf.d:/etc/nginx/conf.d:ro  

    ports:
      -  80:80
    command: [nginx-debug, '-g', 'daemon off;']
  # webサーバー
  nginx:
    volumes:
      - ./public:/usr/share/nginx/html:ro 
    image: nginx

  # awsへの接続を行う
  awscli:
    build: ./aws-cli  
    volumes:
      - ./public:/public
      - ./aws-cli/.aws:/root/.aws
      - ./aws-cli/conf:/conf

  # 単体テストサーバーの起動
  jasmine:
    build: ./tools/jasmine
    volumes:
      - ./public:/home/workdir/public
      - ./src:/home/workdir/src
      - ./tools/jasmine/app.js:/home/workdir/app.js
    working_dir: /home/workdir
    command: node app.js
