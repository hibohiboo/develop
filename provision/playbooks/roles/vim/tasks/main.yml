---
  - name: test vim8でなければインストール
    shell: vim --version  | grep "IMproved 8" warn=no
    register: result
    ignore_errors: True
    # deprecated always_run: yes
    check_mode: no
    failed_when: no
    changed_when: result.rc != 0

# Installation vim8
# https://itsfoss.com/vim-8-release-install/
  - block:
    - name: step 0
      apt: name=vim state=absent

    - name: step1
      apt_repository: repo="ppa:jonathonf/vim"

    - name: step2
      apt: name=vim state=present update_cache=yes
    when: result|failed

  - name: vimパッケージディレクトリ作成
    file: path=/home/vagrant/.vim/pack/mypack/ state=directory

  - name: 空白ハイライトのpackageのソースダウンロード
    git: repo=https://github.com/bronson/vim-trailing-whitespace.git dest=/home/vagrant/.vim/pack/mypack/opt/vim-trailing-whitespace/ version=master accept_hostkey=yes depth=1

  - name: 設定ファイルをコピー
    copy: >
      src=.vimrc
      dest=/home/vagrant/.vimrc
      owner=vagrant
      group=vagrant
      mode=0644