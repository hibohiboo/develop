---
# 1. nginx設定の配備
- name: configure /setup global configuration file
  copy: 
    src: nginx.conf
    dest: /etc/nginx/nginx.conf
    owner: root
    group: root
    mode: 0644

# 2. バーチャルホスト設定の配備
- include_vars: roles/php-fpm/vars/main.yml
- name: configure/ setup wordpress configuration file
  template:
    src: wordpress.conf.j2
    dest: /etc/nginx/conf.d/wordpress.conf
    owner: root
    group: root
    mode: 0644

# # 3. バーチャルホスト設定の配備
# - include_vars: roles/redmine/vars/main.yml
# - name: configure / setup redmine configuration file
#   template:
#     src: redmine.conf.j2
#     dest: /etc/nginx/conf.d/redmine.conf
#     owner: root
#     group: root
#     mode: 0644

# 4.nginx起動
- name: configure/ start nginx service
  systemd:
    name: nginx
    state: reloaded
    enabled: yes

# 4 nginxの起動確認
- name: configure / wait for nginx restart
  wait_for:
    host: "{{ nginx_service_ip }}"
    port: "{{ nginx_service_port }}" 
    delay: 3
    timeout: 60
